TÃ¬m hiá»ƒu vá» PX4
Ground Control Station lÃ  gÃ¬ ? (tay cáº§m)(https://docs.qgroundcontrol.com/master/en/qgc-user-guide/)
- Äá»c cáº£ SIYI MK32
TrÃªn drone thÆ°á»ng sáº½ cÃ³ nhá»¯ng bá»™ pháº­n nÃ o
Giao thá»©c thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng lÃ  gÃ¬? (MAVlink)(CAN ESC)(https://docs.px4.io/main/en/can/)
Äá»ƒ Ä‘iá»u khiá»ƒn drone cáº§n nhá»¯ng thÃ´ng tin vá» dá»¯ kiá»‡n gÃ¬ ? (Telemetry)(height,weight)(elrs)(ARK Flow, VectorNav)
Drone cÃ³ nhá»¯ng kiá»ƒu Ä‘iá»u khiá»ƒn nhÆ° tháº¿ nÃ o  (throttle, yaw, pitch, ..)
TÃ¬m hiá»ƒu xem Drone thÆ°á»ng sá»­ dá»¥ng nhá»¯ng dáº£i táº§n nÃ o Ä‘á»ƒ Ä‘iá»u khiá»ƒn ?
Lá»£i Ã­ch, tÃ¡c háº¡i cá»§a nhá»¯ng dáº£i táº§n?
giao thá»©c truyá»n video vá» ? (rtsp protocol)(telemetry 2.4GHZ ,RC)
tÃ i liá»‡u tham kháº£o
https://px4.io/software/software-overview/
nÃ³ Ä‘Æ°á»£c cá»™ng Ä‘á»“ng phÃ¡t triá»ƒn trÃªn ná»n táº£ng chip STM32H7
https://docs.holybro.com/autopilot/pixhawk-baseboards/pixhawk-jetson-baseboard/overview-and-specification
https://docs.px4.io/main/en/concept/architecture
https://docs.px4.io/main/en/concept/px4_systems_architecture.html
https://docs.px4.io/main/en/flight_stack/controller_diagrams.html
https://docs.px4.io/main/en/can/
https://docs.px4.io/main/en/companion_computer/holybro_pixhawk_jetson_baseboard.html
-PX4 LÃ  gÃ¬ :

+PX4 lÃ  pháº§n má»m Ä‘iá»u khiá»ƒn bay nguá»“n má»Ÿ dÃ nh cho mÃ¡y bay khÃ´ng ngÆ°á»i lÃ¡i (drone) vÃ  cÃ¡c phÆ°Æ¡ng tiá»‡n khÃ´ng ngÆ°á»i lÃ¡i khÃ¡c. Dá»± Ã¡n cung cáº¥p má»™t bá»™ cÃ´ng cá»¥ linh hoáº¡t cho phÃ©p cÃ¡c nhÃ  phÃ¡t triá»ƒn drone chia sáº» cÃ´ng nghá»‡, tá»« Ä‘Ã³ táº¡o ra cÃ¡c giáº£i phÃ¡p phÃ¹ há»£p cho cÃ¡c á»©ng dá»¥ng drone. PX4 cung cáº¥p má»™t tiÃªu chuáº©n Ä‘á»ƒ cung cáº¥p há»— trá»£ pháº§n cá»©ng vÃ  pháº§n má»m cho drone, cho phÃ©p má»™t há»‡ sinh thÃ¡i xÃ¢y dá»±ng vÃ  báº£o trÃ¬ pháº§n cá»©ng vÃ  pháº§n má»m má»™t cÃ¡ch linh hoáº¡t.

-táº¡i sao cÃ¡c nhÃ  phÃ¡t triá»ƒn PX4:

+kiáº¿n trÃºc MÃ´ Äun 
PX4 cÃ³ tÃ­nh mÃ´-Ä‘un hÃ³a cao vÃ  kháº£ nÄƒng má»Ÿ rá»™ng cáº£ vá» pháº§n cá»©ng láº«n pháº§n má»m. NÃ³ sá»­ dá»¥ng kiáº¿n trÃºc dá»±a trÃªn cá»•ng - nghÄ©a lÃ  khi cÃ¡c nhÃ  phÃ¡t triá»ƒn thÃªm cÃ¡c thÃ nh pháº§n, há»‡ thá»‘ng má»Ÿ rá»™ng khÃ´ng bá»‹ máº¥t Ä‘i tÃ­nh máº¡nh máº½ hay hiá»‡u suáº¥t.

+nguá»“n má»Ÿ 
PX4 Ä‘Æ°á»£c phÃ¡t triá»ƒn Ä‘á»“ng thá»i vá»›i má»™t cá»™ng Ä‘á»“ng phÃ¡t triá»ƒn toÃ n cáº§u. Flightstack khÃ´ng chá»‰ Ä‘Ã¡p á»©ng nhu cáº§u cá»§a má»™t phÃ²ng thÃ­ nghiá»‡m hay má»™t cÃ´ng ty, mÃ  cÃ²n Ä‘Æ°á»£c thiáº¿t káº¿ nhÆ° má»™t bá»™ cÃ´ng cá»¥ chung vÃ  Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i trong ngÃ nh.

+kháº£ nÄƒng cáº¥u hÃ¬nh 
PX4 cung cáº¥p cÃ¡c API vÃ  SDK Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a cho cÃ¡c nhÃ  phÃ¡t triá»ƒn lÃ m viá»‡c vá»›i tÃ­ch há»£p. Táº¥t cáº£ cÃ¡c mÃ´-Ä‘un Ä‘á»u Ä‘á»™c láº­p vÃ  cÃ³ thá»ƒ dá»… dÃ ng chuyá»ƒn Ä‘á»•i sang má»™t mÃ´-Ä‘un khÃ¡c mÃ  khÃ´ng cáº§n sá»­a Ä‘á»•i lÃµi. CÃ¡c tÃ­nh nÄƒng dá»… dÃ ng triá»ƒn khai vÃ  cáº¥u hÃ¬nh láº¡i.

+ngÄƒn xáº¿p tá»± Ä‘á»™ng 
PX4 Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ káº¿t há»£p cháº·t cháº½ vá»›i thá»‹ giÃ¡c mÃ¡y tÃ­nh nhÃºng nháº±m mang láº¡i kháº£ nÄƒng tá»± Ä‘á»™ng hÃ³a. Ná»n táº£ng nÃ y giÃºp giáº£m thiá»ƒu rÃ o cáº£n gia nháº­p cho cÃ¡c nhÃ  phÃ¡t triá»ƒn Ä‘ang nghiÃªn cá»©u cÃ¡c thuáº­t toÃ¡n Ä‘á»‹nh vá»‹ vÃ  phÃ¡t hiá»‡n chÆ°á»›ng ngáº¡i váº­t.

- cÃ¡c bá»™ pháº­n trÃªn drone
+----------------------------------------------------+
|                Khung (Frame)                       |
|  |-- Äá»™ng cÆ¡ + CÃ¡nh quáº¡t --|                       |
|  |-- ESC (Ä‘iá»u khiá»ƒn Ä‘á»™ng cÆ¡)                      |
|  |-- Pin (Battery)                                 |
|  |-- Flight Controller (PX4, Pixhawk...)           |
|      |-- IMU (Gyro + Accel)                        |
|      |-- Compass                                   |
|      |-- Barometer                                 |
|  |-- GPS Module                                    |
|  |-- Telemetry Module + Anten                      |
|  |-- Camera + Gimbal (náº¿u cÃ³)                      |
|  |-- RC Receiver                                   |
|  |-- LED, Buzzer                                   |
|  |-- Cáº£m biáº¿n bá»• sung (Lidar, Sonar, Optical Flow)

- trÃªn drone thÆ°á»ng cÃ³ nhá»¯ng bá»™ pháº­n :
+
1. Joystick / Stick (Cáº§n Ä‘iá»u khiá»ƒn)
2. CÃ´ng táº¯c / Switch
3. NÃºm xoay / Potentiometer
4. MÃ n hÃ¬nh hiá»ƒn thá»‹
5. Ä‚ng-ten (Antenna)
6. Cá»•ng káº¿t ná»‘i (USB, Trainer port, module má»Ÿ rá»™ng...)
7. Pin / Battery
8. Buzzer / Loa
9. ÄÃ¨n LED tráº¡ng thÃ¡i


- quy trÃ¬nh truyá»n tÃ­n hiá»‡u lÃªn drone PX4
Quy trÃ¬nh truyá»n tÃ­n hiá»‡u lÃªn drone PX4
CÃ¡c bá»™ pháº­n nháº­p liá»‡u (joystick, switch, nÃºm xoay) â†’ Vi Ä‘iá»u khiá»ƒn tay cáº§m

Vi Ä‘iá»u khiá»ƒn Ä‘á»c cÃ¡c giÃ¡ trá»‹ vÃ  tráº¡ng thÃ¡i, Ä‘Ã³ng gÃ³i thÃ nh báº£n tin Ä‘iá»u khiá»ƒn (theo giao thá»©c: SBUS, CRSF, PPM...).
Vi Ä‘iá»u khiá»ƒn â†’ Module  â†’ Ä‚ng-ten phÃ¡t sÃ³ng

Báº£n tin Ä‘iá»u khiá»ƒn Ä‘Æ°á»£c mÃ£ hÃ³a vÃ  phÃ¡t qua sÃ³ng RF tá»›i drone.
Drone (receiver) â†’ Giáº£i mÃ£ tÃ­n hiá»‡u â†’ PX4 Flight Controller

Bá»™ thu tÃ­n hiá»‡u trÃªn drone nháº­n, giáº£i mÃ£, chuyá»ƒn tá»›i PX4.
PX4 xá»­ lÃ½ lá»‡nh

PX4 nháº­n lá»‡nh, Ä‘iá»u khiá»ƒn Ä‘á»™ng cÆ¡, gimbal, camera, cháº¿ Ä‘á»™ bay...
Telemetry (náº¿u cÃ³)

PX4 gá»­i thÃ´ng tin tráº¡ng thÃ¡i, vá»‹ trÃ­, pin... vá» tay cáº§m, hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh, cáº£nh bÃ¡o cho ngÆ°á»i dÃ¹ng.
VÃ­ dá»¥ thá»±c táº¿:

Khi báº¡n gáº¡t joystick lÃªn, vi Ä‘iá»u khiá»ƒn tay cáº§m chuyá»ƒn thÃ nh kÃªnh throttle, mÃ£ hÃ³a vÃ  phÃ¡t sÃ³ng RF. Drone nháº­n, PX4 tÄƒng tá»‘c Ä‘á»™ng cÆ¡ Ä‘á»ƒ drone bay lÃªn.
Khi báº¡n báº­t cÃ´ng táº¯c â€œReturn to Homeâ€, tay cáº§m gá»­i tÃ­n hiá»‡u cháº¿ Ä‘á»™ vá» PX4, PX4 tá»± Ä‘á»™ng Ä‘iá»u khiá»ƒn drone bay vá» vá»‹ trÃ­ xuáº¥t phÃ¡t.

- dáº£i táº§n Ä‘á»ƒ Ä‘iá»u khiá»ƒn 
+ 900 MHz / 868 MHz
DÃ nh cho cÃ¡c há»‡ thá»‘ng Ä‘iá»u khiá»ƒn táº§m xa (long range) nhÆ° Crossfire, ELRS, R9M...
900 MHz thÆ°á»ng dÃ¹ng á»Ÿ Má»¹; 868 MHz dÃ¹ng á»Ÿ chÃ¢u Ã‚u (theo quy Ä‘á»‹nh vÃ¹ng).
Khoáº£ng cÃ¡ch truyá»n: CÃ³ thá»ƒ lÃªn tá»›i hÃ ng chá»¥c km, xuyÃªn váº­t cáº£n tá»‘t hÆ¡n 2.4 GHz.

- dáº£i táº§n Ä‘á»ƒ truyá»n video live vá»
+ Truyá»n báº±ng tÃ­n hiá»‡u radio (2.4 GHz) dáº£i táº§n rá»™ng pháº¡m vi xa (module ELRS (ExpressLRS))
háº¡n cháº¿ cá»§a dáº£i táº§n nÃ y lÃ  cÃ³ Ä‘á»™ trá»… tÃ­n hiá»‡u truyá»n sÃ³ng kÃ©m khÃ´ng á»•n Ä‘á»‹nh báº±ng 5.8 GHZ
cho video cháº¥t lÆ°á»£ng tháº¥p tá»¥t fps
* cÃ¡ch kháº¯c phá»¥c cÃ³ thá»ƒ thay báº±ng sÃ³ng 5.8ghz Ä‘á»ƒ tÃ­n hiá»‡u Ä‘Æ°á»£c á»•n Ä‘á»‹nh
háº¡n cháº¿ cá»§a cÃ¡ch nÃ y lÃ  (Ä‘Æ°á»ng truyá»n háº¹p , pháº¡m vi ngáº¯n )

-(truyá»n telemetry, truyá»n video), hÃ£y nÃ³i rÃµ hÆ¡n Ä‘á»ƒ mÃ¬nh tÆ° váº¥n chi tiáº¿t!
Telemetry (viá»…n tráº¯c) lÃ  quÃ¡ trÃ¬nh thu tháº­p vÃ  truyá»n dá»¯ liá»‡u tá»« má»™t thiáº¿t bá»‹ á»Ÿ xa (vÃ­ dá»¥: drone, vá»‡ tinh, cáº£m biáº¿n...) vá» mÃ¡y chá»§ hoáº·c thiáº¿t bá»‹ Ä‘iá»u khiá»ƒn trung tÃ¢m Ä‘á»ƒ giÃ¡m sÃ¡t, phÃ¢n tÃ­ch vÃ  Ä‘iá»u khiá»ƒn.

Trong drone PX4, telemetry thÆ°á»ng lÃ  cÃ¡c thÃ´ng tin nhÆ°:

Vá»‹ trÃ­, tá»‘c Ä‘á»™, Ä‘á»™ cao
TÃ¬nh tráº¡ng pin, GPS
Tráº¡ng thÃ¡i bay, lá»—i há»‡ thá»‘ng
Dá»¯ liá»‡u cáº£m biáº¿n (IMU, khÃ­ Ã¡p, v.v.)
Dá»¯ liá»‡u nÃ y Ä‘Æ°á»£c truyá»n vá» máº·t Ä‘áº¥t qua sÃ³ng radio, WiFi, hoáº·c cÃ¡c giao thá»©c nhÆ° MAVLink Ä‘á»ƒ ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ theo dÃµi vÃ  Ä‘iá»u khiá»ƒn drone tá»« xa.
Telemetry tÆ°Æ¡ng tá»± nhÆ° má»™t há»‡ thá»‘ng giÃ¡m sÃ¡t tá»« xa hoáº·c truyá»n dá»¯ liá»‡u tá»± Ä‘á»™ng.
Báº¡n cÃ³ thá»ƒ hÃ¬nh dung nÃ³ giá»‘ng nhÆ°:

Há»™p Ä‘en mÃ¡y bay: Ghi láº¡i vÃ  truyá»n dá»¯ liá»‡u chuyáº¿n bay vá» trung tÃ¢m Ä‘á»ƒ phÃ¢n tÃ­ch.
Äá»“ng há»“ thÃ´ng minh: Gá»­i dá»¯ liá»‡u sá»©c khá»e cá»§a báº¡n vá» Ä‘iá»‡n thoáº¡i.
Cáº£m biáº¿n thá»i tiáº¿t tá»± Ä‘á»™ng: Gá»­i sá»‘ liá»‡u nhiá»‡t Ä‘á»™, Ä‘á»™ áº©m vá» tráº¡m khÃ­ tÆ°á»£ng.
TÃ³m láº¡i, telemetry lÃ  cÃ¡ch thiáº¿t bá»‹ tá»± Ä‘á»™ng gá»­i dá»¯ liá»‡u vá» cho ngÆ°á»i dÃ¹ng hoáº·c há»‡ thá»‘ng giÃ¡m sÃ¡t mÃ  khÃ´ng cáº§n thao tÃ¡c thá»§ cÃ´ng.


- thuáº­t toÃ¡n Ä‘iá»u khiá»ƒn drone https://docs.px4.io/main/en/flight_stack/controller_diagrams.html
+ PID :
2. PID Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ Ä‘Ã¢u trong drone?
Äiá»u khiá»ƒn attitude (gÃ³c nghiÃªng: roll, pitch, yaw).
Giá»¯ vá»‹ trÃ­, Ä‘á»™ cao (position, altitude).
Äiá»u khiá»ƒn tá»‘c Ä‘á»™ Ä‘á»™ng cÆ¡.

3. NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng PID trong drone
Drone nháº­n lá»‡nh (vÃ­ dá»¥: nghiÃªng sang trÃ¡i, bay lÃªn, quay Ä‘áº§u).
Cáº£m biáº¿n (IMU, gyro, accelerometer) Ä‘o tráº¡ng thÃ¡i hiá»‡n táº¡i (gÃ³c, vá»‹ trÃ­, tá»‘c Ä‘á»™).
PID controller so sÃ¡nh tráº¡ng thÃ¡i hiá»‡n táº¡i vá»›i tráº¡ng thÃ¡i mong muá»‘n (setpoint).
TÃ­nh toÃ¡n sai sá»‘ (error = setpoint - actual value).
Ba thÃ nh pháº§n PID xá»­ lÃ½ sai sá»‘:
P (Proportional): Äiá»u chá»‰nh nhanh theo sai sá»‘ tá»©c thá»i.
I (Integral): BÃ¹ trá»« sai sá»‘ tÃ­ch lÅ©y (lÃ¢u dÃ i).
D (Derivative): Dá»± Ä‘oÃ¡n vÃ  giáº£m rung láº¯c báº±ng cÃ¡ch xÃ©t tá»‘c Ä‘á»™ thay Ä‘á»•i sai sá»‘.
Káº¿t quáº£ PID lÃ  tÃ­n hiá»‡u Ä‘iá»u chá»‰nh gá»­i Ä‘áº¿n Ä‘á»™ng cÆ¡ (ESC), giÃºp drone Ä‘áº¡t tráº¡ng thÃ¡i mong muá»‘n.

+. Quaternion Attitude Control (Äiá»u khiá»ƒn tÆ° tháº¿ báº±ng quaternion)
ÄÆ°á»£c mÃ´ táº£ trong pháº§n mÃ´ táº£ file vÃ  tÃ i liá»‡u tham kháº£o:
Nonlinear Quadrocopter Attitude Control (2013) by Dario Brescianini, Markus Hehn and Raffaello D'Andrea.
Thuáº­t toÃ¡n nÃ y sá»­ dá»¥ng quaternion Ä‘á»ƒ Ä‘iá»u khiá»ƒn tÆ° tháº¿ (attitude) cá»§a drone, giÃºp trÃ¡nh cÃ¡c váº¥n Ä‘á» vá» singularity (gÃ³c Euler).
ÄÆ°á»£c triá»ƒn khai trong hÃ m generate_attitude_setpoint vÃ  cÃ¡c hÃ m liÃªn quan Ä‘áº¿n attitude control.

-cÃ¡c giao tiáº¿p trong drone tá»›i bo máº¡ch :
https://docs.px4.io/main/en/companion_computer/holybro_pixhawk_jetson_baseboard


-sÆ¡ Ä‘á»“ Ä‘iá»u khiá»ƒn PX4 tá»« PID Ä‘áº¿n Ä‘á»™ng cÆ¡ :
+------------------+
|  Rate Controller |   â† PID tÃ­nh toÃ¡n moment
| (Roll, Pitch, Yaw) |
+------------------+
          â†“
     torque_sp (Nm)   â† moment mong muá»‘n
          â†“
+------------------+
|      Mixer       |   â† Ã¡nh xáº¡ torque thÃ nh lá»±c Ä‘á»™ng cÆ¡
+------------------+
          â†“
   motor_output (PWM) â† giÃ¡ trá»‹ tá»« 1000 - 2000 Âµs
          â†“
+------------------+
|      ESC         |   â† chuyá»ƒn PWM thÃ nh dÃ²ng Ä‘iá»‡n
+------------------+
          â†“
+------------------+
|    Äá»™ng cÆ¡       |   â† táº¡o lá»±c quay + lá»±c nÃ¢ng
+------------------+


VÃ­ dá»¥:
Interface	MÃ´ táº£
UART (Universal Asynchronous Receiver/Transmitter)	Giao tiáº¿p ná»‘i tiáº¿p, thÆ°á»ng dÃ¹ng giá»¯a vi Ä‘iá»u khiá»ƒn vÃ  cáº£m biáº¿n/module
I2C (Inter-Integrated Circuit)	Giao tiáº¿p ná»‘i tiáº¿p hai dÃ¢y (SDA, SCL)
SPI (Serial Peripheral Interface)	Giao tiáº¿p ná»‘i tiáº¿p bá»‘n dÃ¢y (MOSI, MISO, SCLK, SS)
USB	Giao diá»‡n phá»• biáº¿n giá»¯a mÃ¡y tÃ­nh vÃ  thiáº¿t bá»‹ ngoáº¡i vi
GPIO	Giao diá»‡n Ä‘áº§u vÃ o/ra sá»‘ Ä‘Æ¡n giáº£n

â†’ Interface quy Ä‘á»‹nh pháº§n cá»©ng káº¿t ná»‘i, sá»‘ dÃ¢y, cÃ¡ch Ä‘áº¥u ná»‘i, vÃ  Ä‘áº·c tÃ­nh Ä‘iá»‡n há»c (má»©c Ä‘iá»‡n Ã¡p, tá»‘c Ä‘á»™, v.v.).

ğŸ“¡ 2. Protocol (Giao thá»©c) lÃ  gÃ¬?
Protocol lÃ  táº­p há»£p cÃ¡c quy táº¯c vÃ  Ä‘á»‹nh dáº¡ng dá»¯ liá»‡u Ä‘á»ƒ cÃ¡c thiáº¿t bá»‹ trao Ä‘á»•i thÃ´ng tin vá»›i nhau thÃ´ng qua má»™t interface.

NÃ³ mÃ´ táº£:

CÃ¡ch báº¯t Ä‘áº§u/káº¿t thÃºc giao tiáº¿p

CÃ¡ch Ä‘á»‹nh dáº¡ng dá»¯ liá»‡u

CÃ¡ch kiá»ƒm tra lá»—i

CÃ¡ch Ä‘á»“ng bá»™ hÃ³a

VÃ­ dá»¥:
Protocol	MÃ´ táº£
I2C protocol	Gá»“m start bit, address, R/W bit, ACK/NACK, stop bit
SPI protocol	Äá»‹nh nghÄ©a thá»© tá»± gá»­i bit (MSB/LSB), thá»i Ä‘iá»ƒm chá»‘t dá»¯ liá»‡u
Modbus	Giao thá»©c cÃ´ng nghiá»‡p hoáº¡t Ä‘á»™ng qua RS-485 hoáº·c TCP/IP
CAN protocol	Giao thá»©c cho há»‡ thá»‘ng nhÃºng Ã´ tÃ´, truyá»n qua bus CAN
USB protocol	Phá»©c táº¡p, há»— trá»£ lá»›p device class (audio, mass storage, HID...)

â†’ Protocol náº±m á»Ÿ táº§ng logic hoáº·c pháº§n má»m, Ä‘iá»u khiá»ƒn cÃ¡ch thiáº¿t bá»‹ hiá»ƒu vÃ  xá»­ lÃ½ dá»¯ liá»‡u.
Ä‘Ã¢y lÃ  2 khÃ¡i niá»‡m quan trá»ng trong há»‡ thá»‘ng pháº§n cá»©ng
em cáº§n náº¯m rÃµ vÃ  hiá»ƒu sÃ¢u


MAVlink lÃ  má»™t giao thá»©c sá»­ dá»¥ng Telemetry radio Ä‘á»ƒ gá»­i tÃ­n hiá»‡u lÃªn mÃ¡y bay báº±ng cÃ¡ch táº¡o 1 vá» bá»c bÃªn ngoÃ i rá»“i bá»c láº¥y tÃ­n hiá»‡u cáº§n pháº£i gá»­i vÃ  tÃ­n hiá»‡u nÃ y sáº½ Ä‘Æ°á»£c mavlink gÃ³i láº¡i sau Ä‘Ã³ gá»­i lÃªn mÃ¡y bay 
telemetry radio gá»­i tÃ­n hiá»‡u lÃªn mÃ¡y bay báº±ng cÃ¡ch Ä‘á»“ng bá»™ giáº£i táº§n muá»‘n gá»­i lÃªn mÃ¡y bay nÃ o thÃ¬ dáº£i táº§n pháº£i giá»‘ng vá»›i mÃ¡y bay Ä‘Ã³



I2C :
Start condition :
LÃ  tÃ­n hiá»‡u báº¯t Ä‘áº§u giao tiáº¿p I2C
Do thiáº¿t bá»‹ master phÃ¡t ra 
KhÃ´ng pháº£i lÃ  1 bit dá»¯ liá»‡u mÃ  lÃ  tÃ­n hiá»‡u Ä‘iá»u khiá»ƒn Ä‘áº·c biá»‡t
CÃ¡ch táº¡o tÃ­n hiá»‡u Start :
Start condition xáº£y ra khi :
SDA chuyá»ƒn tá»« HIGH -> LOW trong khi SCL Ä‘ang HIGH [giá»‘ng vá»›i kiá»ƒu master báº£o slave chuáº©n bá»‹ nghe nÃ³ nÃ³i vÃ  slave náº¿u Ä‘Ã£ sáºµn sÃ ng nghe master nÃ³i thÃ¬ truyá»n láº¡i ACK ( vÃ¢ng)]
vai trÃ² cá»§a start bit :
Äá»“ng bá»™ - BÃ¡o hiá»‡u cho táº¥t cáº£ thiáº¿t bá»‹ trÃªn bus ráº±ng má»™t dá»¯ liá»‡u truyá»n má»›i báº¯t Ä‘áº§u
XÃ¡c Ä‘á»‹nh master - Master lÃ  má»™t thiáº¿t bá»‹ phÃ¡t Start
Báº¯t Ä‘áº§u truyá»n - Ngay sau Start, master sáº½ gá»­i Ä‘á»‹a chá»‰ + R/W

Äá»‹a chá»‰ 7-bit tÃ¹y vÃ o module há»— trá»£ tá»« bao nhiÃªu Ä‘áº¿n bao nhiÃªu 
vÃ­ dá»¥ LM75 há»— trá»£ tá»« 0x48 Ä‘áº¿n 0x4F vá»›i cÃ¡c chÃ¢n tá»« 1001A2A1A0 tÃ¹y bÃªn phÃ­a nhÃ  sáº£n xuáº¥t thÃ¬ cÃ³ thá»ƒ lÃ  (AX) cÃ³ thá»ƒ lÃ  0 hoáº·c 1 Ä‘á»ƒ xÃ¡c Ä‘á»‹nh Ä‘á»‹a chá»‰ 
A2	A1	A0	Äá»‹a chá»‰ nhá»‹ phÃ¢n	Äá»‹a chá»‰ HEX
0	0	0	1001000	             0x48
0	0	1	1001001	             0x49
0	1	0	1001010	             0x4A
0	1	1	1001011	             0x4B
1	0	0	1001100	             0x4C
1	0	1	1001101	             0x4D
1	1	0	1001110	             0x4E
1	1	1	1001111	             0x4F

R/W:
(read/write) trong giao thá»©c I2C lÃ  1 bit ráº¥t quan trá»ng . NÃ³ náº±m ngay sau byte Ä‘á»‹a chá»‰ vÃ  cho phÃ©p vi Ä‘iá»u khiá»ƒn (MCU) cho biáº¿t lÃ  nÃ³ muá»‘n Ä‘á»c dá»¯ liá»‡u tá»« thiáº¿t bá»‹ hay ghi dá»¯ liá»‡u vÃ o thiáº¿t bá»‹ 
[7-bit Ä‘á»‹a chá»‰ thiáº¿t bá»‹ ] + [ 1-bit R/W]
0 -> ghi dá»¯ liá»‡u vÃ o thiáº¿t bá»‹ (Write)
1 -> Äá»c dá»¯ liá»‡u tá»« thiáº¿t bá»‹ (Read)
Wire.beginTransmission(LM75_ADDRESS); // Start condition + gá»­i Ä‘á»‹a chá»‰ + R/W = 0

Wire.requestFrom(LM75_ADDRESS, 2);   // Start condition + Ä‘á»‹a chá»‰ + R/W = 1

ACK: lÃ  tÃ­n hiá»‡u pháº£n há»“i 
sau khi nháº­n Ä‘Ãºng Ä‘á»‹a chá»‰ bÃ¡o ACK ((thiáº¿t bá»‹ nháº­n dá»¯ liá»‡u thÃ nh cÃ´ng)Acknowledge)
SDA khi nÃ o báº±ng LOW thÃ¬ lÃ  tÃ­n hiá»‡u bÃ¡o ACK (Ä‘Ã£ nháº­n thÃ nh cÃ´ng) vÃ  muá»‘n nháº­n thÃªm
tÃ­n hiá»‡u pháº£n há»“i ACK tá»›i tá»« SLAVE 
giá»‘ng nhÆ° viá»‡c master ra lá»‡nh lÃ m viá»‡c Ä‘i vÃ  slave cÃ³ nhiá»‡m vá»¥ gá»­i ACK ( Ä‘Ã£ rÃµ thÆ°a ngÃ i )
cÃ²n náº¿u khÃ´ng nghe lá»i hoáº·c Ä‘Ã£ lÃ m Ä‘á»§ rá»“i thÃ¬ slave cÃ³ nhiá»‡m vá»¥ gá»­i NACK ( tÃ´i Ä‘Ã£ lÃ m rá»“i vÃ  khÃ´ng lÃ m ná»¯a or tÃ´i khÃ´ng lÃ m ná»¯a thÆ°a ngÃ i )
náº¿u slave vÃ¢ng lá»i thÃ¬ SDA sáº½ vá» LOW khi Ä‘á»‘i chiáº¿u vá»›i SCL
cÃ²n slave khÃ´ng vÃ¢ng lá»i thÃ¬ SDA sáº½ vá» HIGH khi Ä‘á»‘i chiáº¿u vá»›i SCL khi mÃ  cáº£ 2 tÃ­n hiá»‡u nÃ y Ä‘á»u gá»­i vá»
ACK vÃ  NACK lÃ  bit thá»© 9 Ä‘Æ°á»£c nhÃ©t sau cÃ¹ng bit thá»© 8 khi gá»­i 1 byte dá»¯ liá»‡u
náº¿u khÃ´ng cÃ³ ACK or NACK gá»­i vá» cÃ³ thá»ƒ coi lÃ  coi lÃ  SLAVE bá»‹ Ä‘iáº¿c ( trá»¥c tráº·c káº¿t ná»‘i )  hoáº·c khÃ´ng cÃ³ SLAVE Ä‘á»ƒ nghe lá»‡nh , hoáº·c SLAVE chÆ°a sáºµn sÃ ng cÃ³ nhiá»u nguyÃªn nhÃ¢n chÆ°a sáºµn sÃ ng cÃ³ thá»ƒ do máº¡ch Ä‘iá»‡n Ä‘ang khÃ´ng á»•n Ä‘á»‹nh , quÃ¡ nhiá»‡t , quÃ¡ táº£i , trá»¥c tráº·c vá» linh kiá»‡n gáº¯n trÃªn SLAVE 

SCL vÃ  SDA 
SCL Ä‘Æ°á»£c coi nhÆ° lÃ  má»™t vá»‹ tÆ°á»›ng Ä‘Æ°á»£c master táº¡o ra vá»›i má»¥c Ä‘Ã­ch sáº¯p xáº¿p vá»‹ trÃ­ tá»«ng bit 1 cho nÃ³ Ä‘i Ä‘Ãºng lá»™ trÃ¬nh vÃ  thá»i Ä‘iá»ƒm byte nÃ y Ä‘Æ°á»£c truyá»n Ä‘i 
SDA lÃ  nÆ¡i Ä‘Æ°á»£c coi nhÆ° lÃ  Ä‘Æ°á»ng truyá»n dá»¯ liá»‡u bao gá»“m dá»¯ liá»‡u tá»« thanh ghi vÃ  Ä‘á»c cá»§a Master khi káº¿t ná»‘i vá»›i SLAVE cho phÃ©p master ra chá»‰ thá»‹ cho slave vÃ  slave pháº£n há»“i láº¡i master vá» quÃ¡ trÃ¬nh cÃ´ng viá»‡c giá»‘ng nhÆ° viá»‡c báº¡n pháº£n há»“i láº¡i sáº¿p cá»§a báº¡n khi báº¡n nháº­n Ä‘Æ°á»£c nhiá»‡m vá»¥ lÃ  nhÆ° tháº¿ nÃ o á»Ÿ Ä‘Ã¢y thÃ¬ SDA cho phÃ©p Master vÃ  slave Ä‘Æ°á»£c tá»± do ngÃ´n luáº­n

stop bit : 
Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng sau khi start bit vÃ  lÃ  tÃ­n hiá»‡u cuá»‘i cÃ¹ng 
Ä‘á»ƒ káº¿t thÃºc 1 byte dá»¯ liá»‡u 
tÆ°Æ¡ng tá»± nhÆ° start bit thÃ¬ stop bit cÃ³ pháº§n ngÆ°á»£c láº¡i so vá»›i start lÃ  nÃ³ sáº½ nháº£y 1 bit tá»« LOW lÃªn HIGH khi SCL Ä‘ang HIGH

SPI :
sÆ¡ lÆ°á»£c :
SPI cÃ³ cÃ¡c chÃ¢n MOSI ( master out slave in ) MISO ( master in slave out )
sclk chÃ¢n xung clock nÃ³ giá»‘ng nhÆ° cÃ¡ch start khi mÃ  cÃ´ giÃ¡o gÃµ lÃªn báº£ng thÃ¬ há»c sinh bÃªn dÆ°á»›i Ä‘á»c hoáº·c phÃ¡t biá»ƒu nghÄ©a lÃ  má»—i láº§n chÃ¢n phÃ¡t xung Ä‘Ã³ phÃ¡t xung thÃ¬ slave má»›i Ä‘Æ°á»£c lÃ m nÃ³ cÅ©ng nhÆ° nhá»‹p Ä‘áº­p cá»§a tim khi cÃ³ nhá»‹p Ä‘áº­p thÃ¬ giao thá»©c má»›i lÃ m viá»‡c 
ss chÃ¢n truyá»n data sáº½ cÃ³ láº§n lÆ°á»£t ss1 ss2 ss3 ... ssn 
ss nháº±m cÃ³ má»¥c Ä‘Ã­ch Ä‘Ã³ lÃ  cho data truyá»n Ä‘i Ä‘Ãºng slave cáº§n truyá»n nhiá»‡m vá»¥ trÃ¡nh cho viá»‡c Ä‘iá»u khiá»ƒn bá»‹ rá»‘i
spi cÃ³ má»™t nhÆ°á»£c Ä‘iá»ƒm sá»‘ lÆ°á»£ng dÃ¢y káº¿t ná»‘i ráº¥t nhiá»u vÃ  hiá»‡u quáº£ nháº¥t lÃ  khi cÃ¡c slave á»Ÿ gáº§n 

CÃ¡c thÃ nh pháº§n chÃ­nh cá»§a SPI
Master: Thiáº¿t bá»‹ Ä‘iá»u khiá»ƒn quÃ¡ trÃ¬nh giao tiáº¿p.
Slave: Thiáº¿t bá»‹ nháº­n lá»‡nh vÃ  gá»­i dá»¯ liá»‡u khi Ä‘Æ°á»£c master yÃªu cáº§u.
SCK (Serial Clock): ÄÆ°á»ng xung clock do master táº¡o ra Ä‘á»ƒ Ä‘á»“ng bá»™ hÃ³a viá»‡c truyá»n dá»¯ liá»‡u.
MOSI (Master Out Slave In): ÄÆ°á»ng dá»¯ liá»‡u tá»« master Ä‘áº¿n slave.
MISO (Master In Slave Out): ÄÆ°á»ng dá»¯ liá»‡u tá»« slave vá» master.
SS/CS (Slave Select/Chip Select): ÄÆ°á»ng tÃ­n hiá»‡u do master Ä‘iá»u khiá»ƒn Ä‘á»ƒ chá»n slave nÃ o sáº½ giao tiáº¿p.
QuÃ¡ trÃ¬nh gá»­i má»™t byte dá»¯ liá»‡u trong SPI

Chá»n Slave:
Äá»ƒ báº¯t Ä‘áº§u giao tiáº¿p vá»›i má»™t slave cá»¥ thá»ƒ, master sáº½ kÃ©o Ä‘Æ°á»ng SS/CS tÆ°Æ¡ng á»©ng cá»§a slave Ä‘Ã³ xuá»‘ng má»©c tháº¥p (logic 0).
CÃ¡c slave khÃ¡c trÃªn bus khÃ´ng Ä‘Æ°á»£c chá»n sáº½ giá»¯ Ä‘Æ°á»ng SS/CS cá»§a chÃºng á»Ÿ má»©c cao vÃ  khÃ´ng tham gia vÃ o quÃ¡ trÃ¬nh truyá»n dá»¯ liá»‡u.

Äá»“ng bá»™ hÃ³a vÃ  gá»­i dá»¯ liá»‡u:
Master báº¯t Ä‘áº§u táº¡o ra cÃ¡c xung clock trÃªn Ä‘Æ°á»ng SCK.
Trong má»—i chu ká»³ xung clock, master sáº½ Ä‘áº©y má»™t bit dá»¯ liá»‡u ra Ä‘Æ°á»ng MOSI vÃ  Ä‘á»“ng thá»i Ä‘á»c má»™t bit dá»¯ liá»‡u tá»« Ä‘Æ°á»ng MISO. CÃ¹ng lÃºc Ä‘Ã³, slave sáº½ Ä‘á»c bit tá»« MOSI vÃ  Ä‘áº©y má»™t bit dá»¯ liá»‡u cá»§a nÃ³ ra MISO.
QuÃ¡ trÃ¬nh nÃ y diá»…n ra tuáº§n tá»±, thÆ°á»ng báº¯t Ä‘áº§u vá»›i bit cÃ³ trá»ng sá»‘ cao nháº¥t (MSB) trÆ°á»›c. Äá»ƒ gá»­i má»™t byte (8 bit), quÃ¡ trÃ¬nh nÃ y sáº½ láº·p láº¡i trong 8 chu ká»³ clock.

Trao Ä‘á»•i dá»¯ liá»‡u:
Giáº£ sá»­ master muá»‘n gá»­i byte 0x55 (01010101) Ä‘áº¿n slave.
Trong chu ká»³ clock Ä‘áº§u tiÃªn, master gá»­i bit 0 trÃªn MOSI vÃ  Ä‘á»c má»™t bit tá»« MISO.
Trong chu ká»³ clock thá»© hai, master gá»­i bit 1 vÃ  Ä‘á»c bit tiáº¿p theo.
QuÃ¡ trÃ¬nh nÃ y tiáº¿p tá»¥c cho Ä‘áº¿n háº¿t 8 bit. Sau 8 chu ká»³ clock, master Ä‘Ã£ gá»­i xong byte 0x55 vÃ  Ä‘á»“ng thá»i Ä‘Ã£ nháº­n Ä‘Æ°á»£c má»™t byte dá»¯ liá»‡u tá»« slave.
Äiá»u nÃ y lÃ  Ä‘iá»ƒm khÃ¡c biá»‡t lá»›n nháº¥t so vá»›i I2C: dá»¯ liá»‡u luÃ´n Ä‘Æ°á»£c trao Ä‘á»•i hai chiá»u trong cÃ¹ng má»™t quÃ¡ trÃ¬nh, ngay cáº£ khi master chá»‰ muá»‘n "ghi" (gá»­i) dá»¯ liá»‡u. Master cÃ³ thá»ƒ bá» qua dá»¯ liá»‡u nháº­n Ä‘Æ°á»£c náº¿u khÃ´ng cáº§n.

Káº¿t thÃºc quÃ¡ trÃ¬nh:
Sau khi master gá»­i Ä‘á»§ sá»‘ byte cáº§n thiáº¿t, nÃ³ sáº½ ngá»«ng táº¡o xung clock trÃªn Ä‘Æ°á»ng SCK vÃ  kÃ©o Ä‘Æ°á»ng SS/CS trá»Ÿ láº¡i má»©c cao (logic 1) Ä‘á»ƒ káº¿t thÃºc phiÃªn giao tiáº¿p vá»›i slave Ä‘Ã³.
Äiá»u nÃ y giáº£i phÃ³ng slave Ä‘á»ƒ nÃ³ sáºµn sÃ ng cho cÃ¡c giao tiáº¿p tiáº¿p theo, cÃ³ thá»ƒ lÃ  vá»›i má»™t master khÃ¡c hoáº·c vá»›i cÃ¹ng má»™t master nhÆ°ng trong má»™t phiÃªn má»›i.


CAN :
hiá»ƒu Ä‘Æ¡n giáº£n nÃ³ sáº½ cÃ³ 2 Ä‘Æ°á»ng truyá»n CAN RX vÃ  TX 
RX thÃ¬ thÃ nh LOW cÃ²n TX thÃ¬ thÃ nh thÃ nh HIGH 
náº¿u á»Ÿ má»©c logic 0 thÃ¬ 
Can H sáº½ nháº£y lÃªn 3.5V 
Can L sáº½ xuá»‘ng 0V
cÃ²n náº¿u á»Ÿ má»©c logic 1
Can L ,H lÃªn xuá»‘ng cÃ²n 2.5V khÃ´ng cÃ³ sá»± chÃªnh lá»‡ch Ä‘iá»‡n Ã¡p thÃ¬ á»Ÿ tráº¡ng thÃ¡i khÃ´ng truyá»n dá»¯ liá»‡u
CAN to ECU :
Ä‘Æ°á»£c hiá»ƒu nhÆ° lÃ  dá»¯ liá»‡u tá»« CAN truyá»n qua ECU thÃ¬ sáº½ nháº­n dáº¡ng ECU Ä‘Ã³ thÃ´ng qua ID 


DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ cÃ¡ch mÃ  PX4 xá»­ lÃ½ lá»—i giao thá»©c:

CÆ¡ cháº¿ xá»­ lÃ½ lá»—i theo tá»«ng giao thá»©c
DroneCAN: Giao thá»©c nÃ y cá»±c ká»³ máº¡nh máº½. NÃ³ sá»­ dá»¥ng cÃ¡c gÃ³i tin cÃ³ checksum (mÃ£ kiá»ƒm tra lá»—i) Ä‘á»ƒ Ä‘áº£m báº£o dá»¯ liá»‡u khÃ´ng bá»‹ há»ng trong quÃ¡ trÃ¬nh truyá»n. Náº¿u má»™t gÃ³i tin bá»‹ lá»—i, nÃ³ sáº½ bá»‹ loáº¡i bá». NgoÃ i ra, giao thá»©c CAN Bus cÃ²n cÃ³ kháº£ nÄƒng tá»± Ä‘á»™ng ngáº¯t káº¿t ná»‘i cÃ¡c thiáº¿t bá»‹ bá»‹ lá»—i trÃªn bus Ä‘á»ƒ trÃ¡nh lÃ m áº£nh hÆ°á»Ÿng Ä‘áº¿n toÃ n bá»™ máº¡ng.

I2C vÃ  SPI: CÃ¡c giao thá»©c nÃ y cÃ³ cÆ¡ cháº¿ kiá»ƒm soÃ¡t lá»—i Ä‘Æ¡n giáº£n hÆ¡n. I2C cÃ³ bit ACK (Acknowledge) Ä‘á»ƒ xÃ¡c nháº­n viá»‡c nháº­n dá»¯ liá»‡u, nhÆ°ng khÃ´ng cÃ³ tÃ­nh nÄƒng chá»‘ng nhiá»…u máº¡nh máº½ nhÆ° CAN Bus. Náº¿u cÃ³ lá»—i, PX4 sáº½ cá»‘ gáº¯ng Ä‘á»c láº¡i dá»¯ liá»‡u hoáº·c bÃ¡o lá»—i cáº£m biáº¿n.

UART: ÄÃ¢y lÃ  giao thá»©c cÆ¡ báº£n nháº¥t, thÆ°á»ng khÃ´ng cÃ³ cÆ¡ cháº¿ sá»­a lá»—i tÃ­ch há»£p. Náº¿u dá»¯ liá»‡u bá»‹ há»ng, PX4 sáº½ nháº­n Ä‘Æ°á»£c dá»¯ liá»‡u sai vÃ  cÃ³ thá»ƒ dáº«n Ä‘áº¿n hÃ nh vi khÃ´ng mong muá»‘n.

CÆ¡ cháº¿ an toÃ n tá»•ng thá»ƒ (Failsafe) cá»§a PX4
ÄÃ¢y lÃ  cÆ¡ cháº¿ quan trá»ng nháº¥t Ä‘á»ƒ gá»¡ lá»—i vÃ  phá»¥c há»“i há»‡ thá»‘ng, khÃ´ng chá»‰ giá»›i háº¡n á»Ÿ giao thá»©c. Náº¿u má»™t giao thá»©c gáº·p lá»—i nghiÃªm trá»ng (vÃ­ dá»¥: máº¥t káº¿t ná»‘i vá»›i GPS hoáº·c bá»™ thu sÃ³ng), PX4 sáº½ tá»± Ä‘á»™ng kÃ­ch hoáº¡t cÃ¡c hÃ nh Ä‘á»™ng an toÃ n (failsafe) Ä‘Ã£ Ä‘Æ°á»£c ngÆ°á»i dÃ¹ng cÃ i Ä‘áº·t trÆ°á»›c, bao gá»“m:

Cháº¿ Ä‘á»™ giá»¯ vá»‹ trÃ­ (Hold): Drone sáº½ giá»¯ nguyÃªn vá»‹ trÃ­ hiá»‡n táº¡i.

Quay vá» Ä‘iá»ƒm xuáº¥t phÃ¡t (Return): Drone sáº½ tá»± Ä‘á»™ng quay trá»Ÿ láº¡i Ä‘iá»ƒm cáº¥t cÃ¡nh.

Háº¡ cÃ¡nh kháº©n cáº¥p (Land): Drone sáº½ háº¡ cÃ¡nh táº¡i vá»‹ trÃ­ hiá»‡n táº¡i.

Nhá»¯ng cÆ¡ cháº¿ nÃ y giÃºp há»‡ thá»‘ng tá»± Ä‘á»™ng gá»¡ lá»—i má»™t cÃ¡ch an toÃ n vÃ  phá»¥c há»“i sau khi gáº·p sá»± cá»‘, Ä‘áº£m báº£o drone khÃ´ng gáº·p tai náº¡n do lá»—i giao tiáº¿p.




